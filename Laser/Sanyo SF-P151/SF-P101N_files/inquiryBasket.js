void function($){var offset=function($el){return $el.offset()||{left:0,top:0}};var IInquiryBasket=new Abstract({initBasket:function(){},addItem:function(id,url){},removeItem:function(id){},removeCallBack:function(){},animate:function(start,end,imgUrl,fn){}});var config={type:null,addUrl:null,initUrl:null,removeUrl:null,basketUrl:null,description:null,animate:{width:50,height:50,speed:1000},style:{carrier:"in-basket",basket:"ul",itemHover:"hover",itemSelected:"ibselected",tips:"in-basket-tips",noinfo:"in-basket-nomsg",compare:"btn-main",gotoBasket:"goto"},tab:{title:null,titleCls:null,menuWarp:"in-basket-tab",contentWarp:"in-basket-wrap",content:"in-basket-con",contentSelected:"show",menuSelected:"ibselected",menuUnSelected:"ibinner"},compare:{url:null,max:10,min:2,OVER_LIMIT:"You can only compare a maximum of 10 items at a time.",LESS_LIMIT:"Please select at least two {item}."}};var inquiryBasket=new Clazz(IInquiryBasket,{config:config,inherit:Component},function(cfg){this.setConfig(cfg);if(!this.config.initUrl){throw new Error("initUrl could not be null!")}if(!this.config.addUrl){throw new Error("addUrl could not be null!")}if(!this.config.removeUrl){throw new Error("removeUrl could not be null!")}if(!this.config.basketUrl){throw new Error("basketUrl could not be null!")}this._.isIE6=!-[1,]&&!window.XMLHttpRequest;this._.selected=[];this._.cache=null;this.config.compare.LESS_LIMIT=this.config.compare.LESS_LIMIT.replace("{item}",this.config.description);initialize.call(this)});function initialize(){var carrier;if(!$("#"+this.config.style.carrier).length){carrier=createSkeleton.call(this)}else{carrier=$("#"+this.config.style.carrier)}this.elems.carrier=carrier;this.elems.basketWrap=carrier.find("."+this.config.tab.contentWarp);this.elems.menuWrap=carrier.find("."+this.config.tab.menuWarp);this.elems.basketArea=$('<div class="'+this.config.tab.content+'"></div>');this.elems.basket=$("<ul></ul>");this.elems.title=$('<li class="'+this.config.tab.titleCls+'">'+this.config.tab.title+"</li>");this.elems.counts=$('<span style="margin-left:5px;">(0)</span>');this.elems.basketWrap.append(this.elems.basketArea);this.elems.title.append(this.elems.counts);this.elems.menuWrap.append(this.elems.title);this.elems.funWrap=$('<div class="in-basket-fun"></div>');this.elems.compare=$('<a href="javascript:void(0);" class="btn '+this.config.style.compare+'" target="_blank">Compare</a>');this.elems.funWrap.append(this.elems.compare);this.elems.funWrap.append('<a href="'+this.config.basketUrl+'" target="_blank" class="'+this.config.style.gotoBasket+'">Inquiry Basket <i class="icon">&#xf061;</i></a>');this.elems.tips=$('<div class="'+this.config.style.tips+'" style="display:none;"></div>');this.initBasket()}function createSkeleton(){var carrier=document.createElement("div");carrier.id=this.config.style.carrier;carrier.style.display="none";if(this._.isIE6){document.getElementsByTagName("html")[0].style.cssText="background-image:url(about:blank); background-attachment:fixed;";carrier.style.cssText="position:absolute; right:30px"}var tab="";tab+="<div class="+this.config.tab.contentWarp+"></div>";tab+="<ul class="+this.config.tab.menuWarp+"></ul>";carrier.innerHTML=tab;document.body.appendChild(carrier);return $(carrier)}function arrayRemove(arr,item){var l=arr.length-1;while(l>=0){if(arr[l].id===item.id){arr.splice(l,1);return arr}l--}return arr}function arrContains(arr,item){if(!arr.length){return false}var i,l;for(i=0,l=arr.length;i<l;i++){if(arr[i].id===item.id){return true}}return false}function getCrossData(url,fn){if(url.indexOf("?")===-1){url+="?"}$.getJSON(url+"&jsoncallback=?",function(data){fn&&fn(data)})}function formateUrl(url,type,id){url=url.replace("{type}",type);url=url.replace("{id}",id);return url}function tabTitleFire(e){if(!$(e.target).parents(".in-basket-wrap").length){tabTitle.trigger("click");$(document).unbind("click",tabTitleFire)}}var tabShow,tabTitle;var geoImage=new geometricImage({width:50,height:50,data:"imageUrl"});inquiryBasket.extend({removeCallBack:null,initBasket:function(){this._getData(function(d){this._initData(d);this._initEvent();this._updateList()})},addItem:function(id,imgUrl,fn){$("div#in-basket").show();var that=this;var start=$("."+id).eq(0);var end=this.elems.title;getCrossData(formateUrl(this.config.addUrl,this.config.type,id),function(json){if(json.limit){alert("You can only add a maximum of "+json.limit+" items to your Inquiry Basket.Please delete any one of them before continue.");return false}that._animate(start,end,imgUrl,function(){fn&&fn();that._updateList(that._compare.call(that,json));that._updateCache(json)})})},removeItem:function(id){var that=this;getCrossData(formateUrl(this.config.removeUrl,this.config.type,id),function(json){if(that.removeCallBack){for(var i=0,l=that._.cache.data.length;i<l;i++){if(that._.cache.data[i].id===id){that.removeCallBack(json.sourceId,decodeURIComponent(that._.cache.data[i].imgUrl))}}}that._removeSelected(id);that._updateList(that._compare.call(that,json));that._updateCache(json);if(!json.data.length){that._initBasketArea(false);if(that._.isIE6){that._fixedInIE6.call(that)}}})},_updateCache:function(json){this._.cache=json;this.elems.counts.html("("+json.data.length+")")},_updateList:function(json){if(!json){return}var i,l,lists,item;if(json&&json.add.length){if(!this.elems.basketArea.find(this.config.style.basket).length){this._initBasketArea(true)}for(i=0,l=json.add.length;i<l;i++){item=this._createItem(json.add[i]);this.elems.basket.prepend(item);geoImage.zoom(item.find(".js_showImage")[0])}return}if(json&&json.del.length&&this.elems.basket.length){lists=this.elems.basket.find("li");for(i=0,l=json.del.length;i<l;i++){for(var j=0,t=lists.length;j<t;j++){if($(lists[i]).attr("itemId")===json.del[i].id){$(lists[i]).find("in-basket-delete").trigger("click")}}}}this._autoScroll()},_autoScroll:function(){if(!this.elems.basket.find("li").length){return}this.elems.basket.css("height","auto");this.elems.basket.css("overflow","hidden");var _scrollTop=parseInt(document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop);var top=offset(this.elems.carrier).top-_scrollTop;var basketH=this.elems.basket.outerHeight();var sh=document.documentElement.clientHeight;var fh=this.elems.funWrap.outerHeight();var th=this.elems.title.outerHeight();var h=0;if(this._.isIE6){this.elems.carrier.css("top",_scrollTop+sh-this.elems.carrier.height()+"px")}if(sh-basketH-fh-th<=200&&this.elems.basket){h=sh-fh-th-220;if(h<=this.elems.basket.find("li").eq(0).outerHeight()){h=this.elems.basket.find("li").eq(0).outerHeight()}this.elems.basket.css("height",h);this.elems.basket.css("overflow-y","auto")}},_animate:function(start,end,imgUrl,fn){var animateDiv=document.createElement("div");var animateImg=document.createElement("img");var id="animate"+new Date().getTime();animateDiv.style.cssText="display:none;width:"+this.config.animate.width+"px;height:"+this.config.animate.height+"px;position:absolute; z-index:9999;";animateDiv.id=id;animateImg.src=imgUrl;animateImg.width=this.config.animate.width;animateImg.height=this.config.animate.height;animateDiv.appendChild(animateImg);start.show();var path={start:{x:offset(start).left,y:offset(start).top,angle:325.325,length:0.458},end:{x:offset(end).left+parseInt(end.width())/2,y:offset(end).top,angle:39.018,length:0.18}};document.body.appendChild(animateDiv);$("#"+id).show();$("#"+id).animate({path:new $.path.bezier(path)},this.config.animate.speed,function(){$("#"+id).hide(200);$("#"+id).remove();fn&&fn()})},_initData:function(json){var item;if(!json.data.length){this._initBasketArea(false)}else{this.elems.basket.empty();for(var i=0,l=json.data.length;i<l;i++){item=this._createItem(json.data[i]);this.elems.basket.append(item);geoImage.zoom(item.find(".js_showImage")[0])}this._initBasketArea(true);this._updateCache(json)}this._isShow()},_isShow:function(){if($("div.in-basket-wrap").find("li").size()!=0){$("div#in-basket").show()}else{$("div#in-basket").hide()}},_getData:function(fn){var that=this;getCrossData(formateUrl(this.config.initUrl,this.config.type),function(json){fn.call(that,json);that._updateCache(json)})},_compare:function(json){if(!this._.cache){throw new Error("no cache data!")}var i,result={add:[],del:[]};if(this._.cache.data.length||json.data.length){i=this._.cache.data.length-1;while(i>=0){if(!arrContains(json.data,this._.cache.data[i])){result.del.push(this._.cache.data[i]);arrayRemove(this._.cache.data,this._.cache.data[i])}i--}for(i=0;i<json.data.length;i++){if(!arrContains(this._.cache.data,json.data[i])){result.add.push(json.data[i])}}}return result},_compareCheck:function(flag){this.elems.tips.hide();if(this._.selected.length<this.config.compare.min){this.elems.tips.html(this.config.compare.LESS_LIMIT).show();return false}if(this._.selected.length>this.config.compare.max){this.elems.tips.html(this.config.compare.OVER_LIMIT).show();return false}return true},_initBasketArea:function(bol){if(this.elems.basketArea){this.elems.basketArea.empty();if(bol){this.elems.basketArea.append(this.elems.basket);this.elems.basketArea.append(this.elems.tips);this.elems.basketArea.append(this.elems.funWrap)}else{this.elems.basketArea.append('<div class="'+this.config.style.noinfo+'">No '+this.config.description+" in the Basket</div>")}}},_createItem:function(item){var result="";result+='<li itemId="'+item.id+'">';result+='<div class="in-basket-pic">';result+='<a href="'+decodeURIComponent(item.redirectUrl)+'">';result+='<img class="js_showImage" imageUrl="'+decodeURIComponent(item.imgUrl)+'" alt="">';result+="</a>";result+="</div>";result+='<div class="in-basket-text">';result+='<a href="'+decodeURIComponent(item.redirectUrl)+'" class="in-basket-title" title="'+item.name+'" alt="'+item.name+'">'+item.shortCut+"</a>";result+='<a href="javascript:void(0);" class="in-basket-delete">delete</a>';result+="</div>";result+='<span class="in-basket-check"></span>';result+="</li>";return $(result)},_fixedInIE6:function(){var _scrollTop=parseInt(document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop);this.elems.carrier.css("top",_scrollTop+parseInt(document.documentElement.clientHeight)-this.elems.carrier.height()+"px")},_initEvent:function(){var basket=this.elems.basketArea;var target;var that=this;if(this._.isIE6){$(window).bind("scroll",function(){that._fixedInIE6.call(that)})}$(window).unbind("resize").bind("resize",function(e){if(that.elems.basketArea.hasClass("show")){that._autoScroll.call(that)}if(that._.isIE6){that._fixedInIE6.call(that)}});this.elems.title.unbind("click").bind("click",function(e){e.stopPropagation();basket.toggleClass("show");$(this).toggleClass("ibselected");if(tabShow&&tabShow!==basket){tabShow.removeClass("show");tabTitle.removeClass("ibselected")}if(basket.hasClass("show")){tabShow=basket;tabTitle=$(this)}if($(this).hasClass("ibselected")){that.elems.menuWrap.find("li").addClass("ibinner");$(this).removeClass("ibinner");$(document).bind("click",tabTitleFire);that._autoScroll.call(that)}else{that.elems.menuWrap.find("li").removeClass("ibinner")}if(that._.isIE6){var _scrollTop=parseInt(document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop);that.elems.carrier.css("top",_scrollTop+parseInt(document.documentElement.clientHeight)-that.elems.carrier.height()+"px")}return false});this.elems.compare.unbind("click").bind("click",function(e){e.stopPropagation();if(!that._compareCheck.call(that)){e.preventDefault();return false}var filed,uri;var reg=new RegExp("({ids=(\\S+)})","g");that.config.compare.url.match(reg);filed=RegExp.$2;uri="";for(var i=0,l=that._.selected.length;i<l;i++){uri+=filed+"="+that._.selected[i]+(i===l-1?"":"&")}that.elems.compare.attr("href",that.config.compare.url.replace(RegExp.$1,uri))});basket.unbind("click").bind("click",function(e){var itemId;target=parentItem($(e.target));if(!target[0]){return}itemId=target[0].getAttribute("itemId");if($(e.target).hasClass("in-basket-delete")){e.preventDefault();e.stopPropagation();target.fadeOut("slow",function(){that.removeItem(itemId);that._autoScroll.call(that);if($("div.in-basket-wrap").find("li").size()==1){$("div#in-basket").hide()}else{$("div#in-basket").show()}});return false}if(e.target.nodeName.toLowerCase()==="li"||e.target.nodeName.toLowerCase()==="div"){target.toggleClass(that.config.style.itemSelected);if(target.hasClass(that.config.style.itemSelected)){that._addSelected.call(that,itemId)}else{that._removeSelected.call(that,itemId)}}});basket.unbind("mouseover").bind("mouseover",function(e){target=parentItem($(e.target));target.addClass(that.config.style.itemHover)});basket.unbind("mouseout").bind("mouseout",function(e){target=parentItem($(e.target));target.removeClass(that.config.style.itemHover)});function parentItem(d){if(d[0].nodeName.toLowerCase()==="li"){return d}else{return d.parents("li")}}},_addSelected:function(itemId){var has=false;for(var i=0,l=this._.selected.length;i<l;i++){if(this._.selected[i]===itemId){has=true}}if(!has){this._.selected.push(itemId)}},_removeSelected:function(itemId){var l=this._.selected.length;while(l>0){l--;if(this._.selected[l]===itemId){this._.selected.splice(l,1);return this._.selected}}return this._.selected}});window.InquiryBasket=inquiryBasket}.call(this,jQuery);var product;var add2BasketProd;var company;var add2BasketCom;var refreshHead;var refreshMini;jQuery(function(){var IBalready='<span class="already-in-basket"></span>';var IBadd='<span class="add-to-basket"></span>';product=new InquiryBasket({initUrl:"http://www.made-in-china.com/inquirybasket.do?action=inquiryList&type={type}",addUrl:"http://www.made-in-china.com/inquirybasket.do?action=addInquiry&type={type}&sourceId={id}",removeUrl:"http://www.made-in-china.com/inquirybasket.do?action=deleteInquiry&type={type}&recordId={id}",basketUrl:"http://www.made-in-china.com/inquiry-basket/",type:"prod",description:"product",tab:{title:"Products",titleCls:"in-basket-tab-p"},compare:{url:"http://www.made-in-china.com/inquirybasket.action?action=compareProduct&{ids=selectedIdProduct}&isNeedSimilar=false"}});add2BasketProd=function(id,imgUrl){product.addItem(id,imgUrl,function(){var target=$("."+id);var ad=$(IBalready);ad.addClass(id);if(target.parent().hasClass("js_abs")){ad.append("Already in Basket");target.replaceWith(ad);$("."+id).parent().show()}else{ad.append('<a href="http://www.made-in-china.com/inquiry-basket/" target="_blank"><span class="sh-ico sh-ico-check"></span>Already in Basket</a>');target.replaceWith(ad)}refreshHead()})};product.removeCallBack=function(id,imgUrl){if(!id){return}var ad=$(IBadd);var target=$("."+id);ad.addClass(id);ad.append("<a href=\"javascript:add2BasketProd('"+id+"', '"+imgUrl+'\')" rel="nofollow"><span class="sh-ico sh-ico-basket"></span>Add to Basket</a>');target.replaceWith(ad);if($("."+id).parent().hasClass("js_abs")){$("."+id).parent().hide()}refreshHead()};company=new InquiryBasket({initUrl:"http://www.made-in-china.com/inquirybasket.do?action=inquiryList&type={type}",addUrl:"http://www.made-in-china.com/inquirybasket.do?action=addInquiry&type={type}&sourceId={id}",removeUrl:"http://www.made-in-china.com/inquirybasket.do?action=deleteInquiry&type={type}&recordId={id}",basketUrl:"http://www.made-in-china.com/inquiry-basket/",type:"com",description:"company",tab:{title:"Companies",titleCls:"in-basket-tab-c"},compare:{url:"http://www.made-in-china.com/inquirybasket.action?action=compareCompany&{ids=selectedIdCompany}&isNeedSimilar=false"}});add2BasketCom=function(id,imgUrl){var target=$("."+id);target.eq(0).parent().show();company.addItem(id,imgUrl,function(){var ad=$(IBalready);ad.addClass(id);if(target.parent().hasClass("js_abs")){ad.append("Already in Basket");target.replaceWith(ad);$("."+id).parent().show()}else{ad.append('<a href="http://www.made-in-china.com/inquiry-basket/" target="_blank"><span class="sh-ico sh-ico-check"></span>Already in Basket</a>');target.replaceWith(ad)}var imgI=ad.parent().find("div.pic img");if(imgI.size()==1){imgI.attr("src","http://img.made-in-china.com/img/athena/already-basket.png");imgI.attr("alt","Already in Basket");imgI.parent().attr("href","http://www.made-in-china.com/inquiry-basket/");imgI.parent().attr("target","_blank")}refreshHead()})};company.removeCallBack=function(id,imgUrl){if(!id){return}var ad=$(IBadd);var target=$("."+id);ad.addClass(id);ad.append("<a href=\"javascript:add2BasketCom('"+id+"', '"+imgUrl+'\')" rel="nofollow"><span class="sh-ico sh-ico-basket"></span>Add to Basket</a>');target.replaceWith(ad);if($("."+id).parent().hasClass("js_abs")){$("."+id).parent().hide()}var imgI=ad.parent().find("div.pic img");if(imgI.size()==1){imgI.attr("src","http://img.made-in-china.com/img/athena/basket.png");imgI.attr("alt","Add to Basket");imgI.parent().attr("href","javascript:add2BasketCom('"+id+"', '"+imgUrl+"')");imgI.parent().removeAttr("target")}refreshHead()};refreshHead=function(){window.requestLogonStatus&&window.requestLogonStatus();window.logonRefresh&&window.logonRefresh()};refreshMini=function(){product.initBasket();company.initBasket()}});