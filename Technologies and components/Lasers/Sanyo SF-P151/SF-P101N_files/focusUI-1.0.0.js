/**
 * 《focusUI组件》
 * 功能介绍：界面ui处理：遮罩、定位、拖拽等等
 * 焦点科技界面ui
 * @author xingshikang
 * 版权归焦点科技所有
 */
(function(){if(!!window.jQuery)(function(a){var b={config:{cover_baseFloatZIndex:100,cover_overlay:true},setConfig:function(c){b.config=a.extend(true,b.config,c||{});}};b.tools=(function(){var c={env:(function(){var d=navigator.userAgent.toLowerCase(),e=/*@cc_on!@*/false,f={ie:e,ie6:(function(){if(e)return parseFloat(d.match(/msie (\d+)/)[1])<7||document.compatMode=='BackCompat';return false;})(),mac:d.indexOf('macintosh')>-1,webkit:d.indexOf(' applewebkit/')>-1,isCustomDomain:function(){if(!this.ie)return false;var g=document.domain,h=window.location.hostname;return g!=h&&g!='['+h+']';}};return f;})(),genKey:function(){return Array.prototype.slice.call(arguments).join('-');},setOpacity:function(d,e){if(this.env.ie){e=Math.round(e*100);a(d).css('filter',e>=100?'':'progid:DXImageTransform.Microsoft.Alpha(opacity='+e+')');}else a(d).css('opacity',e);},getViewPaneSize:function(){var d=document.compatMode=='CSS1Compat';return{width:(d?document.documentElement.clientWidth:document.body.clientWidth)||0,height:(d?document.documentElement.clientHeight:document.body.clientHeight)||0};},getScrollPosition:function(){var d=window;if('pageXOffset' in d)return{x:d.pageXOffset||0,y:d.pageYOffset||0};else{var e=d.document;return{x:e.documentElement.scrollLeft||e.body.scrollLeft||0,y:e.documentElement.scrollTop||e.body.scrollTop||0};}},getSize:function(d){return{width:d.offsetWidth||0,height:d.offsetHeight||0};}};return c;})();b.cover=(function(){var c={},d=[],e,f,g=null,h={};function i(m){var n=h.options,o=a(window);if(!m){var p=['<div tabIndex="-1" style="position: ',b.tools.env.ie6?'absolute':'fixed','; z-index: ',g+1,'; top: 0px; left: 0px; ',!b.tools.env.ie6?'background-color: '+n.bgColor:'','" style="display:none" class="',n.coverClass,'">'];if(b.tools.env.ie6)if(b.bgIframe)p.push(b.bgIframe.html(n.bgColor));p.push('</div>');m=a(p.join(''));b.tools.setOpacity(m,n.bgOpacity!=undefined?n.bgOpacity:0.5);m.bind('keydown',function(){return false;});m.bind('keypress',function(){return false;});m.bind('keyup',function(){return false;});a('body').append(m);m.data('options',n);typeof m[n.showAnim]=='function'?m[n.showAnim]():m.show();c[h.coverKey]=m;c[h.coverKey].used=false;}else typeof m[m.data('options').showAnim]=='function'?m[m.data('options').showAnim]():m.show();e=m;var q=m.data('options').rangeId,r=function(){var u=b.tools.getViewPaneSize();if(q&&a('#'+q).length>0&&a('#'+q).attr('id')==q){u=b.tools.getSize(a('#'+q).get(0));var v={x:a('#'+q).offset().left,y:a('#'+q).offset().top};
m.css('position','absolute');m.css({left:v.x+'px',top:v.y+'px'});}m.css({width:u.width+'px',height:u.height+'px'});},s=function(){var u=b.tools.getScrollPosition();if(q&&a('#'+q).length>0&&a('#'+q).attr('id')==q)u={x:a('#'+q).offset().left,y:a('#'+q).offset().top};m.css({left:u.x+'px',top:u.y+'px'});};f=r;o.bind('resize',r);r();if(!(b.tools.env.mac&&b.tools.env.webkit))m.focus();if(b.tools.env.ie6){var t=function(){s();arguments.callee.prevScrollHandler.apply(this,arguments);};o.get(0).setTimeout(function(){t.prevScrollHandler=window.onscroll||(function(){});window.onscroll=t;},0);s();}};function j(m){var n=m?m:e;if(!n)return;var o=a(window);n.hide();o.unbind('resize',f);if(b.tools.env.ie6)o.get(0).setTimeout(function(){var p=window.onscroll&&window.onscroll.prevScrollHandler;window.onscroll=p||null;},0);f=null;};function k(){for(var m in c)c[m].remove();c={};};var l={show:function(m){if(b.tools.env.ie6)b.setConfig({cover_overlay:false});h.options=a.extend(true,{rangeId:'',bgColor:'white',bgOpacity:0.4,baseFloatZIndex:b.config.cover_baseFloatZIndex,showAnim:'fadeIn',dialog:null,overlay:b.config.cover_overlay,coverClass:''},m||{});h.coverKey=b.tools.genKey(h.options.bgColor,h.options.bgOpacity,h.options.baseFloatZIndex,h.options.rangeId);var n=c[h.coverKey];if(g===null||d.length==0)g=b.config.cover_baseFloatZIndex;if(!h.options.overlay){var o=d.length>0?d[d.length-1]:null;if(o&&o.base&&o.key!=h.coverKey)j(c[o.key]);}i(n);if(!c[h.coverKey].used){c[h.coverKey].used=true;d.push({key:h.coverKey,base:true});}else{n.css('z-index',g+1);d.push({key:h.coverKey});}a(h.options.dialog).css('z-index',g+=10);},hide:function(){if(d.length==0)return;var m=d[d.length-1],n=d.length>1?d[d.length-2]:null;if(!(n&&m.key==n.key))j(e);g-=10;if(n){i(c[n.key]);c[n.key].css('z-index',g-9);}if(m.base)c[m.key].used=false;d.pop();},remove:function(){k();d=[];g=null;},getCover:function(){return e;}};return l;})();b.drag=(function(){var c=function(d){var e=this,f=e._=a.extend(true,{dialog:null,title:null,margins:null,magnetDistance:null,rtl:false},d||{});if(!(f.dialog&&f.title))return;var g=f.dialog,h=f.title,i=null,j=null,k=f.magnetDistance,l=f.margins||[0,0,0,0];if(k===null)k=20;function m(q,r,s){var t=a(g).css('position')=='fixed',u=a(g).css('marginTop'),v=a(g).css('marginLeft');if(t&&e._.position&&e._.position.x==q&&e._.position.y==r){}e._.position={x:q,y:r};if(parseFloat(u)!=0&&u!='auto')r-=parseFloat(u);if(parseFloat(v)!=0&&v!='auto')q-=parseFloat(v);if(!t){var w=b.tools.getScrollPosition();
q+=w.x;r+=w.y;}if(f.rtl){var x=b.tools.getSize(a(g).get(0)),y=b.tools.getViewPaneSize();q=y.width-x.width-q;}var z={top:(r>0?r:0)+'px'};z[f.rtl?'right':'left']=(q>0?q:0)+'px';a(g).css(z);s&&(e._.moved=1);};function n(q){var r=b.tools.getSize(a(g).get(0)),s=b.tools.getViewPaneSize(),t=q.screenX,u=q.screenY,v=t-i.x,w=u-i.y,x,y;i={x:t,y:u};j.x+=v;j.y+=w;if(j.x+l[3]<k)x=-l[3];else if(j.x-l[1]>s.width-r.width-k)x=s.width-r.width+(!f.rtl?0:l[1]);else x=j.x;if(j.y+l[0]<k)y=-l[0];else if(j.y-l[2]>s.height-r.height-k)y=s.height-r.height+l[2];else y=j.y;m(x,y,1);q.preventDefault();};function o(q){a(document).unbind('mousemove',n);a(document).unbind('mouseup',o);if(b.tools.env.ie6)if(b.cover&&b.cover.getCover().find('.bgiframe:visible').length!=0){var r=b.cover.getCover().find('.bgiframe:visible').get(0).contentWindow.document;a(r).unbind('mousemove',n);a(r).unbind('mouseup',o);}};a(h).bind('mousedown',function(q){p();i={x:q.screenX,y:q.screenY};a(document).bind('mousemove',n);a(document).bind('mouseup',o);j=e._.position||{};if(b.tools.env.ie6)if(b.cover&&b.cover.getCover().find('.bgiframe:visible').length!=0){var r=b.cover.getCover().find('.bgiframe:visible').get(0).contentWindow.document;a(r).bind('mousemove',n);a(r).bind('mouseup',o);}q.preventDefault();});a(h).bind('mouseover',function(){a(this).css('cursor','move');});a(h).bind('mouseout',function(){a(this).css('cursor','default');});function p(){var q=b.tools.getScrollPosition();e._.position={x:a(g).offset().left-q.x,y:a(g).offset().top-q.y};};p();};return c;})();b.bgIframe=(function(){var c=function(e){if(!b.tools.env.ie6)return '';var f=[],g="<html><body style=\\'background-color:"+e+";\\'></body></html>";f.push('<iframe class="bgiframe" hidefocus="true" frameborder="0" tabindex="-1" style="z-index:-1" src="javascript:');f.push("void((function(){document.open();document.write( '"+g+"' );"+'document.close();'+'})())');f.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;progid:DXImageTransform.Microsoft.Alpha(opacity=100)"></iframe>');return f.join('');},d=function(e){var f=a.extend(true,{dialog:null,bgColor:'white'},e||{});if(!b.tools.env.ie6||f.dialog==null||a(f.dialog).length===0)return;if(a(f.dialog).children('iframe.bgiframe').length===0)a(f.dialog).prepend(c(f.bgColor));};d.html=c;return d;})();b.center=(function(){var c=function(d){var e=d.dialog;if(a(e).length==0)return;delete d.dialog;var f=a.extend(true,{dialog:null,position:'absolute',top:'50%',left:'50%',marginTop:0,relative:true},d||{}),g=a(e);
if(f.top=='50%')f.marginTop=-g.outerHeight()/2;if(f.left=='50%')f.marginLeft=-g.outerWidth()/2;if(f.relative&&!g.parent().is('body')&&g.parent().css('position')=='static')g.parent().css('position','relative');delete f.relative;if(f.position=='fixed'&&b.tools.env.ie6){f.marginTop+=a(window).scrollTop();f.position='absolute';a(window).scroll(function(){g.stop().animate({marginTop:a(window).scrollTop()-g.outerHeight()/2});});}g.css(f);};return c;})();a.fn.focusUI=(function(){var c=function(d){var e=this,f=this.find('h2:first');if(a(e).length==0)return;var g=a.extend(true,{cover:false,drag:false,center:false,bgIframe:true,title:null},d||{});if(g.title&&a(g.title).length>0)f=a(g.title);if(g.cover)FocusUI.cover.show({dialog:e});if(g.bgIframe)if(!g.cover)FocusUI.bgIframe({dialog:e});if(g.center)FocusUI.center({dialog:e,position:'fixed'});if(g.drag)FocusUI.drag({dialog:e,title:f});};return c;})();window.FocusUI=b;})(jQuery);})();
